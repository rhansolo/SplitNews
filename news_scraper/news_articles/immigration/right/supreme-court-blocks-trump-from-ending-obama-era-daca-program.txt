The U.S. Supreme Court blocked President Trump from ending the Deferred Action for Childhood Arrivals program, or DACA, which shields from deportation hundreds of thousands of immigrant children who were brought to the United States illegally.

The court’s decision, 5-4, allows the Obama-era program to stay in place following the Trump administration’s attempt to disassemble it in September 2017. The decision does not say Trump lacks the power to disband DACA but rejects the way it was done. The Trump administration could attempt again to rescind the program.

Chief Justice John Roberts sided with the court's four liberal judges, who agreed the administration's attempt to dismantle the program violated the Administrative Procedure Act.

“Here the agency failed to consider the conspicuous issues of whether to retain forbearance and what if anything to do about the hardship to DACA recipients," Roberts wrote with the backing of Justices Stephen Breyer, Ruth Bader Ginsburg, Elena Kagan, and Sonia Sotomayor. “That dual failure raises doubts about whether the agency appreciated the scope of its discretion or exercised that discretion in a reasonable manner. The appropriate recourse is therefore to remand to DHS so that it may consider the problem anew.”

Conservative Justice Clarence Thomas, backed by Justices Samuel Alito and Neil Gorsuch, wrote in his dissent to the majority ruling that it was "incorrect' and "would hamstring all future agency attempts to undo actions that exceed statutory authority.

“Today’s decision must be recognized for what it is: an effort to avoid a politically controversial but legally correct decision," Thomas added.

Justice Brett Kavanaugh, a Trump appointee, filed a separate opinion.

At the request of then-Attorney General Jeff Sessions, the Department of Homeland Security in 2017 announced it would begin winding down the program over the course of six months on the basis that DACA "was effectuated by the previous administration through executive action, without proper statutory authority and with no established end-date, after Congress' repeated rejection of proposed legislation that would have accomplished a similar result." DHS said it implored Congress to create a legislative solution to the executive branch-created program because only the legislative branch has the power to determine immigration admittance policies.

Under the program, people under the age of 18 who were brought to the U.S. illegally can apply for deportation protection and work permits for two years at a time. Nearly 800,000 people have been approved for DACA over the past eight years, though each recipient must renew their protected status.

Multiple states filed lawsuits against the Trump administration, saying it overstepped its bounds by rescinding a former president's executive action. Judges in two of those lawsuits, in the 9th Circuit Court of Appeals in California and the Eastern District of New York, imposed preliminary injunctions that prevented the program from ending.

DACA was created following a failure by Congress to pass comprehensive immigration reform in 2012 that would have provided a pathway to citizenship for “Dreamers,” or DACA recipients.